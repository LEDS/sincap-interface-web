<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition template="/WEB-INF/templates/form.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:sincap="http://java.sun.com/jsf/composite/sincap">

    <!--@elvariable id="timeZone" type="java.util.TimeZone"-->

    <ui:param name="entrevista" value="true"/>

    <!-- Título da página -->
    <ui:define name="#{sects.title}">
        #{msg['notificacao.step2.tab1.title']}
    </ui:define>
    <!--Fim título da página-->

    <ui:define name="#{sects.formHeader}">
        #{msg['notificacao.msg.etapa.entrevista']}
    </ui:define>

    <!-- Formulário de entrevista -->
    <ui:define name="#{sects.formContent}">
        <form id="notifEntrevista" class="form-horizontal"
              action="http://#{request.serverName}:#{request.serverPort}#{request.contextPath}#{contextUrls.app_notificacao_entrevista}#{contextUrls.salvar}" method="post">
            <!--@elvariable id="_csrf" type="org.springframework.security.web.csrf.DefaultCsrfToken"-->
            <input type="hidden" name="#{_csrf.parameterName}" value="#{_csrf.token}" />
            <sincap:fieldError erro="#{erro}" objectErrors="#{fieldErrors}" msgErro="#{msg['obito.erro']}"/>
            <div class="step-pane active" id="step1">
                <div class="tab-content">
                    <ui:include src="form-entrevista-include.xhtml"/>
                </div>



                <!-- Para manter os objetos quando buscar do banco de dados. -->
                <input type="hidden" id="id" name="id" value="#{processo.id}"/>

                <!-- Salva a data de abertura, se houver -->
                <h:inputHidden id="dataAbertura" value="#{processo.dataAbertura.time}">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{timeZone}" />
                </h:inputHidden>

                <!-- Salva a data de cadastro, se houver -->
                <h:inputHidden id="entrevista-dataCadastro" value="#{processo.entrevista.dataCadastro.time}">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{timeZone}" />
                </h:inputHidden>

                <br/>
                <button type="submit" id="submitFormulario" class="btn-glow success btn-finish">
                    #{msg['geral.button.salvar']}
                </button>
            </div>
        </form>

        <h:outputScript library="js" name="form-entrevista.js" />
        <script>
            if(document.getElementById("entrevistaRealizada:1").checked) {
                $('#divEntrevistaRealizada').hide();
            } else {
                $('#divEntrevistaNaoRealizada').hide();
            }

            if(document.getElementById("doacaoAutorizada:1").checked) {
                $('#divDoacaoAutorizada').hide();
            } else {
                $('#divDoacaoNaoAutorizada').hide();
            }

            document.getElementById("entrevista-responsavel-telefone-numero").addEventListener("keydown", function (e) {
                if(e.key === 'Tab') {
                    e.preventDefault();
                    document.getElementById("entrevista-responsavel-telefone2-numero").focus();
                }
            });

            document.getElementById("entrevista-responsavel-telefone2-numero").addEventListener("keydown", function (e) {
                if(e.key === 'Tab') {
                    e.preventDefault();
                    document.getElementById("entrevista-responsavel-profissao").focus();
                }
            });

            $('#entrevistaRealizada\\:0').click(function () {
                $('#divEntrevistaRealizada').fadeIn();
                $('#divEntrevistaNaoRealizada').fadeOut();
            });
            $('#entrevistaRealizada\\:1').click(function () {
                $('#divEntrevistaNaoRealizada').fadeIn();
                $('#divEntrevistaRealizada').fadeOut();
            });
            $('#doacaoAutorizada\\:0').click(function () {
                $('#divDoacaoAutorizada').fadeIn();
                $('#divDoacaoNaoAutorizada').fadeOut();
            });
            $('#doacaoAutorizada\\:1').click(function () {
                $('#divDoacaoNaoAutorizada').fadeIn();
                $('#divDoacaoAutorizada').fadeOut();
            });
        </script>
    </ui:define>


</ui:composition>
